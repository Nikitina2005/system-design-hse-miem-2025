# Домашнее задание

1. Взять ФТ и НФТ из HW_1
2. Взять сервисы из HW_2
3. Подумать какие БД будут под какие сценарии, описать сценарий выбора
4. Описать дополнительно: репликация, шардинг

## Функциональные требования

Оформлены в виде User Story
1. Как пользователь системы оповещения о неполадках (сотрудник магазина / администратор колл-центра / покупатель), я хочу иметь возможность создать заявку на устранение неполадок, чтобы моя проблема была рассмотрена ИТ-консультантом, в том числе приложив необходимые фотографии или документы.
2. Как пользователь, создающий заявку, я хочу, чтобы заявка была направлена подходящему ИТ-консультанту так, чтобы были учтены географическая и временная доступности консультанта, а также его квалификация, чтобы возникшая проблема как можно быстрее была устранена.
3. Как пользователь системы, я хочу иметь возможность оценить работу консультанта и системы после решения проблемы, так как заинтересован в улучшении качества обслуживания.
4. Как сотрудник компании, я хочу собирать оценки скорости, качества и общего впечатления (по шкале от 1 до 5) работы ИТ-консультантов, чтобы впоследствии анализировать их производительность.
5. Как ИТ-консультант, я хочу видеть историю выполненных работ по предыдущим заявкам клиента, чтобы анализировать и учитывать предыдущие обращения клиента при новых заявках.

## Нефункциональные требования

1. Производительность: система должна обрабатывать до 10000 пользователей одновременно без снижения времени отклика более чем до 1 секунды для 95% запросов.
2. Масштабируемость: система должна позволять масштабирование в географии (подключение новых магазинов по всей территории страны) и количестве пользователей без остановки работы всей системы.
3. Отказоустойчивость: система должна иметь возможность автоматического переключения на зеркальные серверы в случае сбоя.
4. Безопасность: все данные (заявки, пользовательские данные, оценки) должны передаваться и храниться в зашифрованном виде, должна быть обязательная аутентификация и авторизация для консультантов, сотрудников магазина и остальных пользователей системы, при обработке персональных данных клиентов должна соблюдаться информационная безопасность, в том числе по защите данных от утечек.
5. Мониторинг: система должна предоставлять централизованный мониторинг и логирование событий, чтобы обеспечить быстрое обнаружение и устранение сбоев, анализ причин ошибок и контроль над системой.
6. Регуляторные требования: система должна соответствовать федеральному закону "О персональных данных" от 27.07.2006 N 152-ФЗ по защите персональных данных, включая возможность удаления данных клиента по запросу.
7. Переносимость и совместимость системы: система должна быть совместима с основными браузерами и работать как на ПК, так и на мобильных устройствах.
8. Пользовательский опыт: интерфейсы системы должны быть интуитивно понятными и доступными, с откликом интерфейса не более 1 секунды при взаимодействии, особенно при создании заявки и оценке работы ИТ-консультанта, чтобы обеспечить быструю и удобную подачу заявки.

## Сервисы

1. Сервис авторизации и аутентификации;
2. Сервис управления заявками;
3. Сервис управления пользователями;
4. Сервис назначения заявок консультантам;
5. Сервис оценки и отзывов;
6. Сервис уведомлений;
7. Сервис мониторинга и логирования.

## Базы данных

Сценарии и БД под них:
1. Авторизация и аутентификация

Выбор БД: PostgreSQL и Redis

Зачем нужны:

PostgreSQL используется для хранения данных пользователей (логин/пароль) и прав доступа (консультант/клиент), важно то, что она реляционная, так как таблица с данными пользователей должна быть связана ключами с другими таблицами, например, с заявками. Также важна поддержка транзакций.

Redis - для хранения сессий авторизации, в том числе времени, через которое нужна будет новая авторизация.

2. Управление заявками

Выбор БД: PostgreSQL

Зачем нужна:

PostgreSQL используется для хранения данных заявок, пользователей и консультантов, а также связей между соответствующими таблицами с перечисленными данными. Также все еще важно, чтобы были возможны транзакции.

3. Хранение вложений (в заявках)

Выбор БД: MongoDB

Зачем нужна:

MongoDB здесь используется, так как она предназначена для хранения больших объемов данных в виде документов, а также легко масштабируема.

4. Назначение заявок консультантам

Выбор БД: PostgreSQL и Redis

Зачем нужны:

PostgreSQL используется с той же целью, что и в пунктах 1 и 2, Redis используется для кэширования данных о том, какие консультанты доступны, и для управления очередью заявок, на которые нужно назначить консультанта, если все заняты/консультантов с нужной квалификацией и геолокацией нет.

5. История выполненных заявок

Выбор БД: PostgreSQL

Зачем нужна:

PostgreSQL нужна для хранения истории по предыдущим обращениям/заявкам клиентов с поддержкой удобных поиска и построения отчетов.

6. Оценки и отзывы

Выбор БД: PostgreSQL и ClickHouse

Зачем нужны:

PostgreSQL используется для хранения оценок и отзывывов, а также для построения связей между таблицами, например, чтобы связать отзыв, консультанта, заявку, пользователя и т.д., ClickHouse позволяет обработать и проанализировать большие объемы данных.

7. Уведомления

Выбор БД: Redis

Зачем нужна:

Redis используется для поддержки уведомлений через механизм Pub/Sub.

8. Мониторинг и логирование

Выбор БД: ClickHouse

Зачем нужна:

ClickHouse нужна для хранения и анализа логов и метрик.

9. Кэширование данных

Выбор БД: Redis

Зачем нужна: 

Redis обеспечивает быстрый доступ к часто используемым данным, снижая нагрузку на основные базы данных и ускоряя отклик системы.

## Репликация

В PostgreSQL используется как синхронная репликация для более важных данных, например, заявок, пользователей и т.д., так и асинхронная для второстепенных, например, для истории заявок. Репликация необходима здесь для защиты от потери данных и возможности обеспечить постоянный доступ к БД.

В MongoDB, Redis и ClickHouse репликация тоже нужна при реализации данной системы для обеспечения отказоустойчивости. Здесь при отказе какого-то узла должно автоматически происходить переключение на другой узел.

## Шардинг

1. В PostgreSQL используется горизонтальное разбиение по геолокации клиентов и консультантов. В PostgreSQL нет поддержки встроенного шардинга, поэтому можно использовать Citus.

2. В MongoDB шардинг нужен для равномерного распределения больших объемов файлов по узлам, тоже горизонтальное разбиение. Здесь есть встроенная поддержка шардинга.

3. С Redis и ClickHouse аналогично пункту 2, только вместо файлов соответствующие данные, тоже горизонтальное разбиение.
